# Maven Vulnerability Scanner MCP Server

An MCP server that scans Maven pom.xml files for vulnerable dependencies using the OSV (Open Source Vulnerabilities) database.

## Features

- Parses pom.xml content to extract dependencies
- Checks each dependency against the OSV vulnerability database
- Reports vulnerable and safe dependencies
- Provides detailed vulnerability information including severity, summary, and references
- Interactive chat interface with Gemini 2.5 Flash via LiteLLM
- Progress tracking and logging

## Installation

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt
```

## Configuration

Check LLM_PROVIDER and set which one is available with you:

```
LLM_PROVIDER = "OPENAI"  # Options: "GEMINI" or "OPENAI"
```


Create a `.env` file in the project root:

```bash
cp .env.example .env
```

Edit `.env` and add your API key depending on the model you choose above:

```
GEMINI_API_KEY=your-api-key-here
OPENAI_API_KEY=your-api-key-here
```

API Key Resources:
- Gemini: https://aistudio.google.com/app/apikey
- OpenAI: https://platform.openai.com/api-keys

## Usage

### 1. Interactive Chat (Recommended)

Start an interactive chat session with AI-powered vulnerability analysis:

```bash
python3 lightllm_maven_scanner.py
```

**Features:**
- Natural language interaction with Gemini 2.0 Flash or GPT-4
- Auto-detects file paths - just paste them directly
- Intelligent vulnerability analysis and recommendations
- Conversation history maintained throughout session

**Usage examples:**
```
You: /path/to/pom.xml
You: What are the critical vulnerabilities?
You: How should I fix the jackson-databind issues?
```

### 2. Running the MCP Server Standalone

```bash
python3 server.py
```

This starts the MCP server in stdio mode, waiting for MCP client connections.

## MCP Tool Interface

The server exposes a tool called `scan_pom_vulnerabilities` that accepts:

**Input:**
- `pom_content` (string): The complete content of the pom.xml file

**Output:**
- A formatted report showing:
  - Total number of dependencies scanned
  - Number of vulnerable dependencies found
  - Detailed vulnerability information for each vulnerable dependency
  - List of safe dependencies

## Integration Options

### Option 1: Claude Desktop

Add this server to your Claude Desktop MCP settings:

```json
{
  "mcpServers": {
    "maven_vulnerability_scanner": {
      "command": "python3",
      "args": ["/full/path/to/server.py"]
    }
  }
}
```

### Option 2: LiteLLM Integration (This Project)

Use the included `lightllm_maven_scanner.py` for a chat interface with Gemini 2.0 Flash or GPT-4.

## Project Structure

```
.
├── server.py                      # MCP server implementation
├── lightllm_maven_scanner.py      # Interactive chat with LLM + MCP
├── requirements.txt               # Python dependencies
├── sample-pom.xml                 # Sample pom.xml for testing
├── README.md                      # This file
└── .env.example                   # Example environment variables
```

## How It Works

### MCP Server (server.py)

1. Parses the pom.xml content using Python's xml.etree.ElementTree
2. Extracts groupId, artifactId, and version for each dependency
3. Queries the OSV API (https://api.osv.dev) for each dependency
4. Sends progress notifications during scanning
5. Aggregates and formats the results into a readable report

### Interactive Chat (lightllm_maven_scanner.py)

1. Launches the MCP server (server.py) as a subprocess
2. Establishes MCP session and loads available tools
3. Connects to your chosen LLM (Gemini 2.0 Flash or GPT-4) via LiteLLM
4. Provides chat interface for natural language interaction
5. Auto-detects file paths and loads pom.xml content
6. Sends pom content to LLM which calls the MCP tool
7. Receives vulnerability data and provides AI-powered analysis

## Dependencies

- `mcp>=1.0.0` - MCP SDK for Python
- `httpx>=0.27.0` - HTTP client for OSV API requests
- `litellm>=1.0.0` - Multi-LLM integration library
- `openai>=1.0.0` - OpenAI SDK (for alternative integration)
- `python-dotenv>=1.0.0` - Environment variable management

## Examples

### Example 1: Test with Sample File
```bash
python3 lightllm_maven_scanner.py
You: sample-pom.xml
```

### Example 2: AI-Powered Analysis
```bash
python3 lightllm_maven_scanner.py
You: /path/to/pom.xml
You: What are the most critical vulnerabilities?
You: How do I fix the jackson-databind issues?
```

### Example 3: Natural Conversation
```bash
python3 lightllm_maven_scanner.py
You: Can you scan my pom file for vulnerabilities?
Assistant: Sure! Please provide the file path.
You: /Users/me/project/pom.xml
Assistant: [Scans and provides detailed analysis]
```

## Logging

The interactive chat provides detailed logging:
- `[MCP]` - MCP server operations
- `[LLM]` - LLM API interactions (Gemini or OpenAI)
- `[File loaded: ...]` - File operations

## Troubleshooting

**"API_KEY not set"**
- Create `.env` file with your API key (GEMINI_API_KEY or OPENAI_API_KEY)
- Set the correct LLM_PROVIDER in lightllm_maven_scanner.py

**"ModuleNotFoundError"**
- Activate virtual environment: `source venv/bin/activate`
- Install dependencies: `pip install -r requirements.txt`

**"File not found"**
- Use absolute paths or verify file location
- Ensure file has read permissions
